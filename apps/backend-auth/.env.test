# ==============================================================================
# LOCAL DEVELOPMENT ENVIRONMENT - BACKEND AUTH
# ==============================================================================

# Application Configuration
NODE_ENV=development
PORT=3001
SERVICE_NAME=backend-auth

# Database Configuration (PostgreSQL)
# Using docker-compose.dev.yml postgres container
DATABASE_HOST=localhost
DATABASE_PORT=5433
DATABASE_USERNAME=dev
DATABASE_PASSWORD=dev
DATABASE_NAME=dentalos_auth
DATABASE_SSL=false
DATABASE_LOGGING=true
DATABASE_SYNCHRONIZE=false
DATABASE_MAX_CONNECTIONS=10
DATABASE_CONNECT_TIMEOUT=10000

# Database SSL Configuration
# In production, DATABASE_SSL=true is REQUIRED for HIPAA compliance
DATABASE_SSL_REJECT_UNAUTHORIZED=true
DATABASE_SSL_CA=
DATABASE_SSL_CERT=
DATABASE_SSL_KEY=

# PRODUCTION NOTES:
# - DATABASE_SSL=true (required in production)
# - DATABASE_SSL_REJECT_UNAUTHORIZED=true (default, never set to false in production)
# - Provide DATABASE_SSL_CA for cloud providers (AWS RDS, Azure PostgreSQL, GCP Cloud SQL)
# - Provide DATABASE_SSL_CERT and DATABASE_SSL_KEY for mutual TLS (optional, higher security)

# Redis Configuration
# Using docker-compose.dev.yml redis container
REDIS_HOST=localhost
REDIS_PORT=6381
REDIS_PASSWORD=devredis
REDIS_DB=0
REDIS_TLS=false
REDIS_KEY_PREFIX=dentalos:auth:

# JWT Configuration (Use shared secrets from .env.docker for local dev)
JWT_ACCESS_SECRET=dev-access-secret-32chars-min-123456789012
JWT_REFRESH_SECRET=dev-refresh-secret-32chars-min-123456789012
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d
JWT_ISSUER=dentalos-auth
JWT_AUDIENCE=dentalos-api

# Device Tokens
DEVICE_TOKEN_SECRET=dev-device-secret-32chars-min-123456789012

# CORS Configuration
CORS_ORIGINS=http://localhost:3000,http://localhost:3002,http://localhost:5173
CORS_CREDENTIALS=true

# Rate Limiting Configuration
RATE_LIMIT_TTL=60000
RATE_LIMIT_MAX_REQUESTS=100

# Per-Tenant Rate Limiting (prevents noisy neighbor attacks)
RATE_LIMIT_PER_TENANT_ENABLED=true
RATE_LIMIT_TENANT_TTL=900000  # 15 minutes
RATE_LIMIT_TENANT_MAX=5000

# Auth Endpoint Rate Limiting (stricter for security)
RATE_LIMIT_AUTH_TTL=60000  # 1 minute
RATE_LIMIT_AUTH_MAX=10

# Password Reset Rate Limiting (very strict)
RATE_LIMIT_PASSWORD_RESET_TTL=300000  # 5 minutes
RATE_LIMIT_PASSWORD_RESET_MAX=3

# Password Hashing (Argon2id)
# OWASP-recommended defaults for balance between security and performance
ARGON2_MEMORY_COST=65536  # 64 MB memory usage
ARGON2_TIME_COST=3        # 3 iterations (~300ms hashing time)
ARGON2_PARALLELISM=4      # 4 parallel threads

# PRODUCTION NOTES:
# - Increase ARGON2_MEMORY_COST to 131072 (128 MB) for higher security on powerful servers
# - Increase ARGON2_TIME_COST to 4-5 if acceptable latency increase for authentication
# - Never decrease below defaults - doing so weakens password protection

# Logging Configuration
LOG_LEVEL=debug
LOG_FORMAT=json
LOG_COLORIZE=false

# Twilio (MFA SMS) - leave unset to disable
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+15551234567

# Security Headers (Helmet)
HELMET_ENABLED=true
HELMET_CSP_ENABLED=false

# API Documentation (Swagger)
SWAGGER_ENABLED=true
SWAGGER_PATH=api/docs
SWAGGER_TITLE=DentalOS Auth API
SWAGGER_DESCRIPTION=Authentication and Authorization Microservice
SWAGGER_VERSION=1.0

# Health Check Configuration
HEALTH_CHECK_DATABASE_TIMEOUT=3000
HEALTH_CHECK_REDIS_TIMEOUT=3000
HEALTH_CHECK_MEMORY_HEAP_THRESHOLD=150
HEALTH_CHECK_DISK_THRESHOLD=0.9

# Encryption Configuration (HIPAA Compliance)
ENCRYPTION_KEY=z5tC8SjHhCZt5+WfOCIQpCvAMoKXGRJbTvsm3g21e2k=
ENCRYPTION_ALGORITHM=aes-256-gcm

# Audit Trail Configuration
AUDIT_ENABLED=true
AUDIT_LOG_DATABASE=true
AUDIT_LOG_EVENTS=true

# Session Management
SESSION_TIMEOUT=30m
SESSION_MAX_CONCURRENT=5
SESSION_ABSOLUTE_TIMEOUT=24h

# Multi-Tenant Configuration
TENANT_ISOLATION_STRICT=true
TENANT_VALIDATION_ENABLED=true

# RabbitMQ Configuration (for event publishing)
# Using docker-compose.dev.yml rabbitmq container
RABBITMQ_HOST=amqp://dev:dev@localhost:5672/
RABBITMQ_PORT=5672
RABBITMQ_USERNAME=dev
RABBITMQ_PASSWORD=dev
RABBITMQ_VHOST=/
RABBITMQ_EXCHANGE=dentalos.events
RABBITMQ_QUEUE_PREFIX=auth.

# Graceful Shutdown
SHUTDOWN_TIMEOUT=10000

# Feature Flags
FEATURE_REGISTRATION_ENABLED=true
FEATURE_PASSWORD_RESET_ENABLED=true
FEATURE_MFA_ENABLED=false
FEATURE_SSO_ENABLED=false

# MFA Configuration (Multi-Factor Authentication)
# Twilio Configuration (SMS MFA)
TWILIO_ACCOUNT_SID=your_twilio_account_sid_here
TWILIO_AUTH_TOKEN=your_twilio_auth_token_here
TWILIO_PHONE_NUMBER=+1234567890

# SendGrid Configuration (Email MFA)
SENDGRID_API_KEY=your_sendgrid_api_key_here
SENDGRID_FROM_EMAIL=noreply@dentalos.com

# MFA Settings
MFA_ENABLED=true
MFA_TOTP_ISSUER=DentalOS
MFA_SMS_CODE_LENGTH=6
MFA_SMS_VALIDITY_MINUTES=5
MFA_SMS_MAX_ATTEMPTS=3
MFA_EMAIL_CODE_LENGTH=6
MFA_EMAIL_VALIDITY_MINUTES=10
MFA_EMAIL_MAX_ATTEMPTS=3
# Subscription Service Integration
SUBSCRIPTION_SERVICE_URL=http://localhost:3011
SUBSCRIPTION_SERVICE_TIMEOUT=5000
SUBSCRIPTION_SERVICE_CIRCUIT_BREAKER_THRESHOLD=5
SUBSCRIPTION_SERVICE_CIRCUIT_BREAKER_TIMEOUT=60000
