# Application Configuration
NODE_ENV=development
PORT=3301
SERVICE_NAME=backend-auth

# Database Configuration (PostgreSQL)
DATABASE_HOST=dentalos-auth-db.cn40gk80sz2o.eu-central-1.rds.amazonaws.com
DATABASE_PORT=5432
DATABASE_USERNAME=dental_dei69
DATABASE_PASSWORD=S6Freelancer69!
DATABASE_NAME=dentalos_auth
DATABASE_SSL=true
DATABASE_LOGGING=true
DATABASE_SYNCHRONIZE=false
DATABASE_MAX_CONNECTIONS=10
DATABASE_CONNECT_TIMEOUT=10000

# Database SSL Configuration
# In production, DATABASE_SSL=true is REQUIRED for HIPAA compliance
DATABASE_SSL_REJECT_UNAUTHORIZED=true
DATABASE_SSL_CA=
DATABASE_SSL_CERT=
DATABASE_SSL_KEY=

# PRODUCTION NOTES:
# - DATABASE_SSL=true (required in production)
# - DATABASE_SSL_REJECT_UNAUTHORIZED=true (default, never set to false in production)
# - Provide DATABASE_SSL_CA for cloud providers (AWS RDS, Azure PostgreSQL, GCP Cloud SQL)
# - Provide DATABASE_SSL_CERT and DATABASE_SSL_KEY for mutual TLS (optional, higher security)

# Redis Configuration
REDIS_HOST=master.dentalos-redis.iyu7la.euc1.cache.amazonaws.com
REDIS_PORT=6379
REDIS_PASSWORD=d5596a97c1e3cf602a6f2103c99b780c
REDIS_DB=0
REDIS_TLS=true
REDIS_KEY_PREFIX=dentalos:auth:

# JWT Configuration
JWT_ACCESS_SECRET=51a25284fd39339b405c4c3c199a8ecdc65e34d44aa2067ec12abd16ccddacb9
JWT_REFRESH_SECRET=53f424d3bd39b529f921e738c32f7fb181e222ac995f1c463344039bd6e6cf5c
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d
JWT_ISSUER=dentalos-auth
JWT_AUDIENCE=dentalos-api

# Device Tokens
DEVICE_TOKEN_SECRET=d87afe653ccc8f90579a149e573ed1a9806a2c389cbffe06742fff4a555acfe7

# CORS Configuration
CORS_ORIGINS=http://localhost:3000,http://localhost:3002,http://localhost:5173
CORS_CREDENTIALS=true

# Rate Limiting Configuration
RATE_LIMIT_TTL=60000
RATE_LIMIT_MAX_REQUESTS=100

# Per-Tenant Rate Limiting (prevents noisy neighbor attacks)
RATE_LIMIT_PER_TENANT_ENABLED=true
RATE_LIMIT_TENANT_TTL=900000  # 15 minutes
RATE_LIMIT_TENANT_MAX=5000

# Auth Endpoint Rate Limiting (stricter for security)
RATE_LIMIT_AUTH_TTL=60000  # 1 minute
RATE_LIMIT_AUTH_MAX=10

# Password Reset Rate Limiting (very strict)
RATE_LIMIT_PASSWORD_RESET_TTL=300000  # 5 minutes
RATE_LIMIT_PASSWORD_RESET_MAX=3

# Password Hashing (Argon2id)
# OWASP-recommended defaults for balance between security and performance
ARGON2_MEMORY_COST=65536  # 64 MB memory usage
ARGON2_TIME_COST=3        # 3 iterations (~300ms hashing time)
ARGON2_PARALLELISM=4      # 4 parallel threads

# PRODUCTION NOTES:
# - Increase ARGON2_MEMORY_COST to 131072 (128 MB) for higher security on powerful servers
# - Increase ARGON2_TIME_COST to 4-5 if acceptable latency increase for authentication
# - Never decrease below defaults - doing so weakens password protection

# Logging Configuration
LOG_LEVEL=debug
LOG_FORMAT=json
LOG_COLORIZE=false

# Twilio (MFA SMS) - leave unset to disable
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_PHONE_NUMBER=+15551234567

# Security Headers (Helmet)
HELMET_ENABLED=true
HELMET_CSP_ENABLED=false

# API Documentation (Swagger)
SWAGGER_ENABLED=true
SWAGGER_PATH=api/docs
SWAGGER_TITLE=DentalOS Auth API
SWAGGER_DESCRIPTION=Authentication and Authorization Microservice
SWAGGER_VERSION=1.0

# Health Check Configuration
HEALTH_CHECK_DATABASE_TIMEOUT=3000
HEALTH_CHECK_REDIS_TIMEOUT=3000
HEALTH_CHECK_MEMORY_HEAP_THRESHOLD=150
HEALTH_CHECK_DISK_THRESHOLD=0.9

# Encryption Configuration (HIPAA Compliance)
ENCRYPTION_KEY=change-me-in-production-use-32-byte-base64-encoded-key
ENCRYPTION_ALGORITHM=aes-256-gcm

# Audit Trail Configuration
AUDIT_ENABLED=true
AUDIT_LOG_DATABASE=true
AUDIT_LOG_EVENTS=true

# Session Management
SESSION_TIMEOUT=30m
SESSION_MAX_CONCURRENT=5
SESSION_ABSOLUTE_TIMEOUT=24h

# Multi-Tenant Configuration
TENANT_ISOLATION_STRICT=true
TENANT_VALIDATION_ENABLED=true

# RabbitMQ Configuration (for event publishing)
RABBITMQ_HOST=amqps://b-43363c10-db77-447a-a45b-08c8ae5824e4.mq.eu-central-1.on.aws:5671
RABBITMQ_PORT=5671
RABBITMQ_USERNAME=appuser
RABBITMQ_PASSWORD=ecbbd8613a483d00f3d46d453b349257
RABBITMQ_VHOST=/
RABBITMQ_EXCHANGE=dentalos.events
RABBITMQ_QUEUE_PREFIX=auth.

# Graceful Shutdown
SHUTDOWN_TIMEOUT=10000

# Feature Flags
FEATURE_REGISTRATION_ENABLED=true
FEATURE_PASSWORD_RESET_ENABLED=true
FEATURE_MFA_ENABLED=false
FEATURE_SSO_ENABLED=false

# MFA Configuration (Multi-Factor Authentication)
# Twilio Configuration (SMS MFA)
TWILIO_ACCOUNT_SID=your_twilio_account_sid_here
TWILIO_AUTH_TOKEN=your_twilio_auth_token_here
TWILIO_PHONE_NUMBER=+1234567890

# SendGrid Configuration (Email MFA)
SENDGRID_API_KEY=your_sendgrid_api_key_here
SENDGRID_FROM_EMAIL=noreply@dentalos.com

# MFA Settings
MFA_ENABLED=true
MFA_TOTP_ISSUER=DentalOS
MFA_SMS_CODE_LENGTH=6
MFA_SMS_VALIDITY_MINUTES=5
MFA_SMS_MAX_ATTEMPTS=3
MFA_EMAIL_CODE_LENGTH=6
MFA_EMAIL_VALIDITY_MINUTES=10
MFA_EMAIL_MAX_ATTEMPTS=3

# ==============================================================================
# SUBSCRIPTION SERVICE INTEGRATION
# ==============================================================================
#
# Auth service communicates with subscription service to validate licenses
# and check feature access for authenticated users.
#
# CONFIGURATION:
# - Local development: http://localhost:3311
# - Docker: http://subscription:3311 (service name in docker-compose)
# - Production: Use internal service URL or API gateway
#
# CIRCUIT BREAKER:
# - Protects auth service from subscription service failures
# - Falls back gracefully when subscription service is unavailable
# - Configurable timeout and retry behavior
#
# ==============================================================================

# Subscription Service URL
# - Local (from host): http://localhost:3311
# - Docker (from container): http://subscription:3311
# - Production: Internal service URL (e.g., http://subscription-service.internal:3311)
SUBSCRIPTION_SERVICE_URL=http://localhost:3311

# Subscription Service Timeout (milliseconds)
# - Maximum time to wait for subscription service response
# - Prevents auth service from hanging if subscription service is slow
# - Recommendation: 5000ms (5 seconds)
# - Increase if subscription service operations are legitimately slow
SUBSCRIPTION_SERVICE_TIMEOUT=5000

# Circuit Breaker Threshold
# - Number of consecutive failures before opening circuit
# - When circuit is open, requests fail fast without calling subscription service
# - Helps prevent cascading failures
# - Recommendation: 5 failures
SUBSCRIPTION_SERVICE_CIRCUIT_BREAKER_THRESHOLD=5

# Circuit Breaker Timeout (milliseconds)
# - How long to wait before attempting to close circuit after it opens
# - After timeout, circuit moves to half-open state and tries one request
# - Recommendation: 60000ms (60 seconds)
SUBSCRIPTION_SERVICE_CIRCUIT_BREAKER_TIMEOUT=60000
