# ============================================================================
# SECURITY CONFIGURATION - Backend Enterprise Service
# ============================================================================
#
# CRITICAL: Never commit actual secrets to version control
# Use this as a template and create .env with real values
#
# Security Configuration Guide:
# - All secrets should be generated with cryptographically secure random generators
# - Rotate secrets every 90 days minimum
# - Use different secrets for dev, staging, and production
# - Store production secrets in AWS Secrets Manager, HashiCorp Vault, or similar
#
# ============================================================================

# ----------------------------------------------------------------------------
# Application Configuration
# ----------------------------------------------------------------------------
PORT=3017
NODE_ENV=production  # CRITICAL: Must be 'production' for production deployment

# ----------------------------------------------------------------------------
# JWT Authentication
# ----------------------------------------------------------------------------
# CRITICAL: Generate strong random secret (minimum 256 bits)
# Generate using: openssl rand -base64 64
# NEVER use the example value below in production
JWT_SECRET=REPLACE_WITH_STRONG_RANDOM_SECRET_MIN_256_BITS
JWT_ISSUER=dentalos-auth-service
JWT_EXPIRES_IN=15m  # Short-lived access tokens (15 minutes)
JWT_REFRESH_EXPIRES_IN=7d  # Refresh tokens (7 days)

# ----------------------------------------------------------------------------
# Database Security
# ----------------------------------------------------------------------------
# CRITICAL: MongoDB URI must use TLS/SSL in production
# Format: mongodb+srv://username:password@cluster.mongodb.net/database?retryWrites=true&w=majority
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/enterprise?retryWrites=true&w=majority
MONGODB_TLS=true  # CRITICAL: Always true for production
MONGODB_AUTH_SOURCE=admin

# Database connection pool settings
MONGODB_MIN_POOL_SIZE=2
MONGODB_MAX_POOL_SIZE=10
MONGODB_MAX_IDLE_TIME_MS=10000

# Database timeouts (milliseconds)
MONGODB_SERVER_SELECTION_TIMEOUT_MS=5000
MONGODB_SOCKET_TIMEOUT_MS=45000
MONGODB_CONNECT_TIMEOUT_MS=10000

# ----------------------------------------------------------------------------
# Redis Configuration (Rate Limiting & Session Management)
# ----------------------------------------------------------------------------
REDIS_HOST=redis-cluster.cache.amazonaws.com
REDIS_PORT=6379
# CRITICAL: Generate strong password
# Generate using: openssl rand -base64 32
REDIS_PASSWORD=REPLACE_WITH_STRONG_RANDOM_PASSWORD
REDIS_DB=0
REDIS_TLS=true  # Enable TLS for Redis in production

# ----------------------------------------------------------------------------
# Rate Limiting Configuration
# ----------------------------------------------------------------------------
RATE_LIMIT_ENABLED=true  # CRITICAL: Must be true for production

# Rate limits (requests per minute)
RATE_LIMIT_DEFAULT=100
RATE_LIMIT_PUBLIC=20  # Unauthenticated requests
RATE_LIMIT_WRITE=50   # POST, PUT, PATCH, DELETE
RATE_LIMIT_READ=200   # GET requests
RATE_LIMIT_AUTH=5     # Authentication endpoints (prevent brute force)

# ----------------------------------------------------------------------------
# CORS Configuration
# ----------------------------------------------------------------------------
# CRITICAL: Restrict to known domains in production
# Multiple origins: https://app.example.com,https://admin.example.com
CORS_ORIGIN=https://app.dentalos.com
CORS_CREDENTIALS=true

# ----------------------------------------------------------------------------
# Encryption Configuration
# ----------------------------------------------------------------------------
# Field-level encryption master key
# Generate using: openssl rand -base64 32
ENCRYPTION_MASTER_KEY=REPLACE_WITH_STRONG_RANDOM_KEY

# AWS KMS Configuration (recommended for production)
AWS_KMS_KEY_ID=arn:aws:kms:us-east-1:123456789012:key/12345678-1234-1234-1234-123456789012
AWS_REGION=us-east-1

# ----------------------------------------------------------------------------
# Audit Logging Configuration
# ----------------------------------------------------------------------------
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_YEARS=7  # HIPAA requires minimum 6 years
AUDIT_LOG_VERIFY_INTEGRITY_DAILY=true

# ----------------------------------------------------------------------------
# Service URLs (Internal Communication)
# ----------------------------------------------------------------------------
AUTH_SERVICE_URL=https://auth.dentalos.internal:3001
HR_SERVICE_URL=https://hr.dentalos.internal:3015
SCHEDULING_SERVICE_URL=https://scheduling.dentalos.internal:3002
CLINICAL_SERVICE_URL=https://clinical.dentalos.internal:3005
BILLING_SERVICE_URL=https://billing.dentalos.internal:3010
INVENTORY_SERVICE_URL=https://inventory.dentalos.internal:3008
MARKETING_SERVICE_URL=https://marketing.dentalos.internal:3011
AUTOMATION_SERVICE_URL=https://automation.dentalos.internal:3013
AI_ENGINE_SERVICE_URL=https://ai-engine.dentalos.internal:3014

# ----------------------------------------------------------------------------
# Logging Configuration
# ----------------------------------------------------------------------------
LOG_LEVEL=info  # Options: error, warn, info, debug, verbose
LOG_PHI_SAFE=true  # CRITICAL: Never log PHI/PII, only IDs
LOG_CORRELATION_ID=true

# ----------------------------------------------------------------------------
# Security Headers Configuration
# ----------------------------------------------------------------------------
# Content Security Policy
CSP_ENABLED=true
CSP_DIRECTIVES="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline';"

# HTTP Strict Transport Security
HSTS_ENABLED=true
HSTS_MAX_AGE=31536000  # 1 year in seconds
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# ----------------------------------------------------------------------------
# Request Security
# ----------------------------------------------------------------------------
# Request size limits (bytes)
REQUEST_SIZE_LIMIT_JSON=1048576  # 1 MB
REQUEST_SIZE_LIMIT_FORM=102400   # 100 KB
REQUEST_SIZE_LIMIT_FILE=10485760 # 10 MB
REQUEST_SIZE_LIMIT_DEFAULT=512000 # 500 KB

# Request timeout (milliseconds)
REQUEST_TIMEOUT=30000  # 30 seconds

# ----------------------------------------------------------------------------
# IP Whitelisting (Optional)
# ----------------------------------------------------------------------------
IP_WHITELIST_ENABLED=false
IP_WHITELIST=192.168.1.0/24,10.0.0.0/8

# ----------------------------------------------------------------------------
# Multi-Factor Authentication (MFA)
# ----------------------------------------------------------------------------
MFA_ENABLED=true
MFA_ISSUER=DentalOS
MFA_ALGORITHM=SHA1  # TOTP algorithm
MFA_DIGITS=6        # Code length
MFA_PERIOD=30       # Time step in seconds

# ----------------------------------------------------------------------------
# Session Management
# ----------------------------------------------------------------------------
SESSION_TIMEOUT=3600000  # 1 hour in milliseconds
SESSION_ABSOLUTE_TIMEOUT=28800000  # 8 hours in milliseconds
SESSION_MAX_CONCURRENT=3  # Maximum concurrent sessions per user

# ----------------------------------------------------------------------------
# Monitoring & Alerting
# ----------------------------------------------------------------------------
MONITORING_ENABLED=true

# CloudWatch Configuration
CLOUDWATCH_ENABLED=true
CLOUDWATCH_LOG_GROUP=/aws/dentalos/enterprise-service
CLOUDWATCH_REGION=us-east-1

# Datadog Configuration
DATADOG_ENABLED=false
DATADOG_API_KEY=REPLACE_WITH_DATADOG_API_KEY
DATADOG_SITE=datadoghq.com

# Alert thresholds
ALERT_THRESHOLD_AUTH_FAILURES=10  # Per minute
ALERT_THRESHOLD_TENANT_VIOLATIONS=1  # Any violation triggers alert
ALERT_THRESHOLD_RATE_LIMIT_EXCEEDED=100  # Per minute
ALERT_THRESHOLD_ERROR_RATE=0.05  # 5% error rate

# ----------------------------------------------------------------------------
# Backup & Disaster Recovery
# ----------------------------------------------------------------------------
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM (cron format)
BACKUP_RETENTION_DAYS=90
BACKUP_ENCRYPTION_ENABLED=true

# ----------------------------------------------------------------------------
# Development & Testing (Disable in Production)
# ----------------------------------------------------------------------------
# CRITICAL: All of these must be false/disabled in production
SWAGGER_ENABLED=false  # Disable API documentation in production
DEBUG_MODE=false
ALLOW_INSECURE_CONNECTIONS=false
DISABLE_AUTH=false  # NEVER disable authentication in production
DISABLE_RATE_LIMITING=false
DISABLE_AUDIT_LOGGING=false

# ----------------------------------------------------------------------------
# Feature Flags (Security-Related)
# ----------------------------------------------------------------------------
FEATURE_FLAG_MFA_ENFORCEMENT=true
FEATURE_FLAG_IP_WHITELIST=false
FEATURE_FLAG_DEVICE_FINGERPRINTING=true
FEATURE_FLAG_ANOMALY_DETECTION=true
FEATURE_FLAG_AUTO_LOGOUT=true

# ----------------------------------------------------------------------------
# Compliance Configuration
# ----------------------------------------------------------------------------
COMPLIANCE_MODE=HIPAA  # Options: HIPAA, GDPR, PCI_DSS, SOC2, ALL
DATA_RESIDENCY=US  # Data residency requirement
PRIVACY_MODE=STRICT

# GDPR Configuration
GDPR_DATA_RETENTION_DAYS=2555  # 7 years
GDPR_RIGHT_TO_ERASURE_ENABLED=true
GDPR_DATA_PORTABILITY_ENABLED=true

# HIPAA Configuration
HIPAA_AUDIT_RETENTION_YEARS=7
HIPAA_ENCRYPTION_REQUIRED=true
HIPAA_MINIMUM_PASSWORD_LENGTH=12

# ----------------------------------------------------------------------------
# Security Notifications
# ----------------------------------------------------------------------------
SECURITY_NOTIFICATION_EMAIL=security@dentalos.com
SECURITY_NOTIFICATION_SLACK_WEBHOOK=https://hooks.slack.com/services/YOUR/WEBHOOK/URL

# ----------------------------------------------------------------------------
# Penetration Testing & Security Scanning
# ----------------------------------------------------------------------------
SECURITY_SCAN_ENABLED=true
SECURITY_SCAN_SCHEDULE=0 3 * * 0  # Weekly on Sunday at 3 AM
PENTEST_MODE=false  # Enable only during authorized penetration tests
