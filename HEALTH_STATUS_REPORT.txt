================================================================================
                    DENTALOS MICROSERVICES HEALTH REPORT
                              Generated 2025-11-24
================================================================================

EXECUTIVE SUMMARY
================================================================================

System Status:           ALL SERVICES DOWN (READY FOR STARTUP)
Port Conflicts:          NONE DETECTED
Configuration:           VALID AND COMPLETE
Bootstrap Status:        READY
Health Check Script:     READY

================================================================================
DETAILED SERVICE STATUS
================================================================================

INFRASTRUCTURE SERVICES:
------------------------

1. PostgreSQL (Auth DB)
   Port:           5433 (external) -> 5432 (internal)
   Status:         DOWN
   Container:      dentalos-postgres-auth
   Volume:         dentalos-pgdata-auth
   Health Check:   pg_isready probe configured (10s interval)
   Dependencies:   None
   Config Source:  docker-compose.dev.yml

2. PostgreSQL (Subscription)
   Port:           5434 (external) -> 5432 (internal)
   Status:         DOWN
   Container:      dentalos-postgres-subscription
   Volume:         dentalos-pgdata-subscription
   Health Check:   pg_isready probe configured (10s interval)
   Dependencies:   None
   Config Source:  docker-compose.dev.yml

3. Redis
   Port:           6381 (external) -> 6379 (internal)
   Status:         DOWN
   Container:      dentalos-redis
   Volume:         dentalos-redisdata
   Health Check:   redis-cli ping configured (10s interval)
   Auth Required:  YES (password: devredis)
   Dependencies:   None
   Config Source:  docker-compose.dev.yml

4. MongoDB
   Port:           27018 (external) -> 27017 (internal)
   Status:         DOWN
   Container:      dentalos-mongo
   Volume:         dentalos-mongodata
   Health Check:   mongosh admin.ping() configured (10s interval)
   Dependencies:   None
   Config Source:  docker-compose.dev.yml

5. RabbitMQ
   Ports:          5672 (AMQP), 15672 (Management UI)
   Status:         DOWN
   Container:      dentalos-rabbitmq
   Volume:         dentalos-rabbitmqdata
   Health Check:   rabbitmq-diagnostics ping (15s interval)
   Auth Required:  YES (user: dev, pass: dev)
   Management UI:  http://localhost:15672
   Dependencies:   None
   Config Source:  docker-compose.dev.yml

6. MinIO (S3 Object Storage)
   Ports:          9000 (API), 9001 (Console)
   Status:         DOWN
   Container:      dentalos-minio
   Volume:         dentalos-miniodata
   Health Check:   HTTP curl health endpoint (15s interval)
   Access Key:     minioadmin
   Secret Key:     minioadmin
   Console URL:    http://localhost:9001
   Dependencies:   None
   Config Source:  docker-compose.dev.yml

APPLICATION SERVICES:
---------------------

1. Auth Service
   Port:           3301 (external) -> 3001 (internal)
   Framework:      NestJS
   Database:       PostgreSQL
   Status:         DOWN
   Container:      dentalos-auth
   Health Endpoint: GET /api/v1/health
   Dependencies:   postgres (healthy), redis (healthy), rabbitmq (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

2. Scheduling Service
   Port:           3302 (external) -> 3002 (internal)
   Framework:      NestJS
   Database:       MongoDB
   Status:         DOWN
   Container:      dentalos-scheduling
   Health Endpoint: GET /api/v1/health
   Dependencies:   mongo (healthy), redis (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

3. Provider Schedule Service
   Port:           3303 (external) -> 3003 (internal)
   Framework:      NestJS
   Database:       MongoDB
   Status:         DOWN
   Container:      dentalos-provider-schedule
   Health Endpoint: GET /api/v1/health
   Dependencies:   mongo (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

4. Patient Service
   Port:           3304 (external) -> 3004 (internal)
   Framework:      NestJS
   Database:       MongoDB
   Status:         DOWN
   Container:      dentalos-patient
   Health Endpoint: GET /api/v1/health
   Dependencies:   mongo (healthy), redis (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

5. Clinical Service
   Port:           3305 (external) -> 3005 (internal)
   Framework:      NestJS
   Database:       MongoDB
   Status:         DOWN
   Container:      dentalos-clinical
   Health Endpoint: GET /api/v1/health
   Dependencies:   mongo (healthy), redis (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

6. Inventory Service
   Port:           3308 (external) -> 3008 (internal)
   Framework:      NestJS
   Database:       MongoDB + MinIO
   Status:         DOWN
   Container:      dentalos-inventory
   Health Endpoint: GET /api/v1/health
   Dependencies:   mongo (healthy), redis (healthy), minio (started)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

7. Billing Service
   Port:           3310 (external) -> 3010 (internal)
   Framework:      NestJS
   Database:       MongoDB
   Status:         DOWN
   Container:      dentalos-billing
   Health Endpoint: GET /api/v1/health
   Dependencies:   mongo (healthy), redis (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

8. Subscription Service
   Port:           3311 (external) -> 3011 (internal)
   Framework:      NestJS
   Database:       PostgreSQL
   Status:         DOWN
   Container:      dentalos-subscription
   Health Endpoint: GET /api/v1/health
   Dependencies:   postgres-subscription (healthy), redis (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

9. Enterprise Service
   Port:           3317 (external) -> 3017 (internal)
   Framework:      NestJS
   Database:       MongoDB
   Status:         DOWN
   Container:      dentalos-enterprise
   Health Endpoint: GET /api/v1/health
   Dependencies:   mongo (healthy), redis (healthy)
   Startup Time:   ~30 seconds (after dependencies ready)
   Hot Reload:     ENABLED (nodemon)
   Config Source:  docker-compose.dev.yml

10. Health Aggregator
    Port:           3399 (external) -> 3099 (internal)
    Framework:      NestJS
    Database:       None (aggregator service)
    Status:         DOWN
    Container:      dentalos-health-aggregator
    Health Endpoint: GET /api/v1/health
    Dependencies:   all application services
    Startup Time:   ~30 seconds (after all services ready)
    Hot Reload:     ENABLED (nodemon)
    Purpose:        Central health monitoring of all services
    Config Source:  docker-compose.dev.yml

FRONTEND:
---------

Web Frontend (Clinic Portal)
   Port:           5173
   Framework:      React + Vite
   Status:         DOWN
   Container:      dentalos-web
   Dev Server:     npm run dev
   Dependencies:   auth, patient, scheduling
   Hot Reload:     ENABLED (Vite HMR)
   Config Source:  docker-compose.dev.yml

================================================================================
PORT AVAILABILITY ANALYSIS
================================================================================

Port Conflict Check:        NO CONFLICTS DETECTED

Available for services:
  3301 (auth)              ✓ AVAILABLE
  3302 (scheduling)        ✓ AVAILABLE
  3303 (provider-schedule) ✓ AVAILABLE
  3304 (patient)           ✓ AVAILABLE
  3305 (clinical)          ✓ AVAILABLE
  3308 (inventory)         ✓ AVAILABLE
  3310 (billing)           ✓ AVAILABLE
  3311 (subscription)      ✓ AVAILABLE
  3317 (enterprise)        ✓ AVAILABLE
  3399 (health-aggregator) ✓ AVAILABLE
  5173 (web)               ✓ AVAILABLE

Available for infrastructure:
  5433 (postgresql auth)   ✓ AVAILABLE
  5434 (postgresql sub)    ✓ AVAILABLE
  6381 (redis)             ✓ AVAILABLE
  27018 (mongodb)          ✓ AVAILABLE
  5672 (rabbitmq)          ✓ AVAILABLE
  15672 (rabbitmq mgmt)    ✓ AVAILABLE
  9000 (minio api)         ✓ AVAILABLE
  9001 (minio console)     ✓ AVAILABLE

================================================================================
DOCKER COMPOSE CONFIGURATION VALIDATION
================================================================================

Configuration File:      docker-compose.dev.yml
Validation Status:       PASSED

✓ Version:              3.9 (valid, though deprecated)
✓ Services:             16 total (6 infra + 10 app + 1 bootstrap + 1 web)
✓ Networks:             1 (dental-dev)
✓ Volumes:              9 (pgdata, pgdata-subscription, mongodata, etc.)
✓ Health Checks:        All services configured
✓ Dependencies:         All health-based dependencies configured
✓ Environment:          Loaded from .env.docker
✓ Images:               All specified
✓ Commands:             All startup commands valid

Configuration Issues:    NONE DETECTED

================================================================================
STARTUP SEQUENCE ANALYSIS
================================================================================

Phase 1: Infrastructure Services (Parallel Startup)
  Start Time:        0 seconds
  Expected Duration: 60-90 seconds total
  Services:          postgres, postgres-subscription, redis, mongo, rabbitmq, minio
  Health Checks:     All have startup_period configured
  Status:            ALL WILL START IN PARALLEL

Phase 2: Bootstrap (if needed, first run only)
  Start Time:        After infrastructure healthy (60-90 sec)
  Expected Duration: 3-5 minutes
  Tasks:
    1. Install pnpm dependencies
    2. Build @dentalos/shared-types
    3. Build @dentalos/shared-domain
    4. Build @dentalos/shared-validation
    5. Build @dentalos/shared-auth
    6. Build @dentalos/shared-errors
    7. Build @dentalos/shared-events
    8. Build @dentalos/shared-infra
    9. Build @dentalos/shared-security
    10. Build @dentalos/shared-testing
    11. Build @dentalos/shared-tracing
  Status:            WILL RUN IF NEEDED (skipped if dependencies already installed)

Phase 3: Application Services (Parallel, with dependency constraints)
  Start Time:        After bootstrap or ~60-90 sec after infrastructure
  Expected Duration: 60-90 seconds
  Services Starting:
    - auth (waits for: postgres✓, redis✓, rabbitmq✓)
    - scheduling (waits for: mongo✓, redis✓)
    - provider-schedule (waits for: mongo✓)
    - patient (waits for: mongo✓, redis✓)
    - clinical (waits for: mongo✓, redis✓)
    - inventory (waits for: mongo✓, redis✓, minio)
    - billing (waits for: mongo✓, redis✓)
    - subscription (waits for: postgres-subscription✓, redis✓)
    - enterprise (waits for: mongo✓, redis✓)
  Status:            ALL WILL START IN PARALLEL WHEN DEPENDENCIES MET

Phase 4: Health Aggregator
  Start Time:        After all core services ready (120-150 sec)
  Expected Duration: 30 seconds
  Services:          health-aggregator (depends_on: auth, patient, scheduling, subscription, billing)
  Status:            WILL START AFTER CORE SERVICES AVAILABLE

Phase 5: Frontend
  Start Time:        After core services ready (120-150 sec)
  Expected Duration: 30 seconds
  Services:          web (depends_on: auth, patient, scheduling)
  Status:            WILL START AFTER CORE SERVICES AVAILABLE

Total Estimated Startup Time:
  Without bootstrap:  3-5 minutes
  With bootstrap:     5-10 minutes (first run only)

================================================================================
ENVIRONMENT CONFIGURATION SUMMARY
================================================================================

Configuration File:       .env.docker
Configuration Status:     VALID AND COMPLETE

Key Settings:
  NODE_ENV:                development
  COMPOSE_PROJECT_NAME:    dentalos
  DEBUG_MODE:              start:watch
  LOG_LEVEL:               debug
  SWAGGER_ENABLED:         true
  PRETTY_PRINT_LOGS:       true

Database Configuration:
  PostgreSQL (Auth):
    Host:                  postgres
    Port:                  5432 (internal), 5433 (external)
    User:                  dev
    Password:              dev
    Database:              dentalos_auth

  PostgreSQL (Subscription):
    Host:                  postgres-subscription
    Port:                  5432 (internal), 5434 (external)
    User:                  dental_user
    Password:              dental_password
    Database:              dentalos_subscription

  MongoDB:
    Host:                  mongo
    Port:                  27017 (internal), 27018 (external)
    Databases:
      - patient
      - dental-scheduling
      - provider-schedule
      - dentalos_clinical
      - inventory
      - billing
      - enterprise

Cache Configuration:
  Redis:
    Host:                  redis
    Port:                  6379 (internal), 6381 (external)
    Password:              devredis
    Database:              0

Message Queue:
  RabbitMQ:
    Host:                  rabbitmq
    AMQP Port:             5672
    Management Port:       15672
    User:                  dev
    Password:              dev
    Queue Prefix:          dev.

Object Storage:
  MinIO:
    Endpoint:              http://minio:9000
    Access Key:            minioadmin
    Secret Key:            minioadmin
    Bucket:                dentalos-local
    Region:                us-east-1

Security:
  JWT_ACCESS_SECRET:       dev-access-secret-32chars-min-123456789012
  JWT_REFRESH_SECRET:      dev-refresh-secret-32chars-min-123456789012
  ENCRYPTION_KEY:          dev-encryption-key-32bytes-min-123456789012

CORS:
  Allowed Origins:         http://localhost:3000, http://localhost:5173

================================================================================
HEALTH CHECK CAPABILITIES
================================================================================

Health Check Script:       scripts/health-check.sh (executable)
Features:
  ✓ Checks all infrastructure services
  ✓ Tests all 10 application services
  ✓ Verifies health endpoints (HTTP 200)
  ✓ Detects port conflicts
  ✓ Displays Docker container status
  ✓ Analyzes service dependencies
  ✓ Provides colored output
  ✓ Shows overall system health percentage
  ✓ Verbose mode for detailed logs (-v flag)
  ✓ JSON export capability

Health Endpoints Available:
  All services expose:      GET /api/v1/health
  All services expose:      GET /health/detailed (optional)
  Aggregator:               GET /api/v1/health (monitors all)

Health Check Intervals (once running):
  PostgreSQL:               10 seconds
  Redis:                    10 seconds
  MongoDB:                  10 seconds
  RabbitMQ:                 15 seconds
  MinIO:                    15 seconds
  App Services:             30 seconds

================================================================================
TROUBLESHOOTING SUMMARY
================================================================================

If services fail to start:
  1. Check Docker daemon:       docker ps
  2. Run health check:          ./scripts/health-check.sh
  3. Review startup logs:       docker-compose -f docker-compose.dev.yml logs
  4. Check specific service:    docker-compose -f docker-compose.dev.yml logs auth
  5. Verify dependencies:       docker-compose -f docker-compose.dev.yml ps postgres redis
  6. Reset and restart:         ./launch_docker.sh dev --reset-db --wait

Port conflicts:
  1. Identify port:             lsof -i :3301
  2. Kill process:              kill -9 <PID>
  3. Or stop all:               ./launch_docker.sh down

Bootstrap issues:
  1. Clean install:             ./launch_docker.sh --install
  2. Then restart:              ./launch_docker.sh dev --wait

Database issues:
  1. Reset databases:           ./launch_docker.sh dev --reset-db
  2. Check database logs:       docker-compose -f docker-compose.dev.yml logs postgres mongo
  3. Verify connections:        docker network inspect dental-dev

Hot reload not working:
  1. Restart service:           docker-compose -f docker-compose.dev.yml restart auth
  2. Check volume mounts:       docker inspect dentalos-auth | grep -A 5 Mounts
  3. Verify file changes:       ls -la /workspace/apps/backend-auth

================================================================================
NEXT STEPS
================================================================================

1. START SERVICES:
   cd /home/adrian/Desktop/SBD-Projects/personal/preclinic/dental
   ./launch_docker.sh dev --wait

2. VERIFY HEALTH:
   ./scripts/health-check.sh

3. TEST ENDPOINTS:
   curl http://localhost:3301/api/v1/health
   curl http://localhost:3399/api/v1/health

4. ACCESS FRONTEND:
   http://localhost:5173

5. MONITOR LOGS:
   docker-compose -f docker-compose.dev.yml logs -f

================================================================================
REFERENCE DOCUMENTS
================================================================================

Complete Documentation:
  - MICROSERVICES_HEALTH_REPORT.md
    Comprehensive technical documentation of all services, ports, dependencies,
    environment configuration, and SLO requirements.

  - SERVICE_STARTUP_GUIDE.md
    Step-by-step startup and verification procedures with troubleshooting.

  - DOCKER_COMMANDS.md
    Quick reference for Docker compose commands and operations.

Key Files:
  - docker-compose.dev.yml      (Service configuration)
  - launch_docker.sh            (Startup script)
  - .env.docker                 (Environment variables)
  - scripts/health-check.sh     (Health monitoring)

================================================================================
SYSTEM STATUS CONCLUSION
================================================================================

Assessment:                ALL SERVICES READY FOR STARTUP
Configuration Status:     VALID AND COMPLETE
Port Availability:        ALL PORTS AVAILABLE
Docker Environment:       PROPERLY CONFIGURED
Health Monitoring:        READY
Documentation:            COMPREHENSIVE

Recommendation:           PROCEED WITH STARTUP

Command to Start:
  ./launch_docker.sh dev --wait

Expected Result:
  Within 5-10 minutes, all 16 services (6 infrastructure + 10 application)
  will be running, healthy, and ready to handle requests. Frontend will be
  accessible at http://localhost:5173.

================================================================================
Report Generated:  2025-11-24
Status:            READY FOR DEPLOYMENT
================================================================================
